{% extends "base.html" %}
{% block content %}

<section id="home" class="main_content">
    <div class="container">
      <div class="row mt-5">

    <!--LEFT SIDE HOME-->
    <div class="col-md-6 col-sm-12">
        <div class="card card-body mb-3 shadow-sm">
          <h4 class="text-center mb-1">
            <b>Generated Fantasy Team</b>
          </h4>

        <!-- Make a df of credits players and points scored -->
        <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Table</th>
                <th scope="col">Player</th>
                <th scope="col">Team</th>
                <th scope="col">Points</th>
                <th scope="col">Credits</th>
                <th scope="col">Roles</th>

              </tr>
            </thead>
            <tbody>
                {% for d in range(0,len_data) %}
              <tr>
                <th scope="row">{{d+1}}</th>
                <td name ='players' value="{{data_players[d]}}">{{data_players[d]}}</td>
                <td name ='teams' value="{{data_teams[d]}}">{{data_teams[d]}}</td>
                <td name ='points' value="{{data_points[d]}}">{{data_points[d]}}</td>
                <td name ='credits' value="{{data_credits[d]}}">{{data_credits[d]}}</td>
                <td name ='roles' value="{{data_roles[d]}}">{{data_roles[d]}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>

          <p id='team1_name' value = "{{team1_name}}" style="display: none;">{{team1_name}}</p>
          <p id='team2_name' value = "{{team2_name}}" style="display: none;">{{team2_name}}</p>
    
</div>
</div>
</div>
</div>
<div>
  <h1>Pie Chart</h1>
  <div>
    <canvas id = 'chart' width="401" height="401" style="display: block; box-sizing: border-box; height: 401px; width: 401px;"></canvas>
  </div>

</div>
</section>

<script>
  var players = ''
  var teams = ''
  var points = ''
  var credits = ''
  var roles = ''
  var team1 = ''
  var team2 = '' 

   players = document.getElementsByName('players')
   teams = document.getElementsByName('teams')
   points = document.getElementsByName('points')
   credits = document.getElementsByName('credits')
   roles = document.getElementsByName('roles')

   team1 = document.getElementById('team1_name').innerHTML
   team2 = document.getElementById('team2_name').innerHTML
  

function get_data(str_data){

  team1_count = 0
  team2_count = 0

  if(str_data == 'teams'){
    for(var i=0;i<11;i++){
      
    if(teams[i].innerHTML == team1){
      team1_count+=1
    }
    else{
      team2_count+=1
    }
  }
  // console.log("Team count:", [team1_count,team2_count])
  return [team1_count,team2_count]
  }

  else{
    for(var i=0;i<11;i++){

    if(teams[i].innerHTML == team1 && roles[i].innerHTML == str_data){
      team1_count++
    }
    else if(teams[i].innerHTML == team2 && roles[i].innerHTML == str_data){
      team2_count++
    }
  }
  }
  // console.log(str_data,"count:", [team1_count,team2_count])
  return [team1_count,team2_count]
}

function get_multiseriespie_input(){

  var data = {
  labels: ['Team1', 'Team2', 'Batsmen Team1', 'Batsmen Team2', 'Bowlers Team1', 'Bowlers Team2', 'All-Rounders Team1', 'All-Rounders Team2','Wicket keeper Team1','Wicket keeper Team2'],
  //labels: ['Overall Yay', 'Overall Nay', 'Group A Yay', 'Group A Nay', 'Group B Yay', 'Group B Nay', 'Group C Yay', 'Group C Nay'],
  datasets: [
    { //teams 
      backgroundColor: ['#AAA', '#777'],
      data: get_data('teams')
    },
    {
      //Get Batsmen
      backgroundColor: ['hsl(0, 100%, 60%)', 'hsl(0, 100%, 35%)'],
      data: get_data('BAT')
    },
    {
      backgroundColor: ['hsl(100, 100%, 60%)', 'hsl(100, 100%, 35%)'],
      data: get_data('BWL')
    },
    {
      backgroundColor: ['hsl(180, 100%, 60%)', 'hsl(180, 100%, 35%)'],
      data: get_data('AR')
    },
    {
      backgroundColor: ['hsl(280, 100%, 60%)', 'hsl(280, 100%, 35%)'],
      data: get_data('WK')
    }
  ]
};
// </block:setup>
display_chart(data)
}

function display_chart(data){
  // <block:config:0>
  
  const config = {
  type: 'pie',
  data: data,
  options: {
    responsive: true,
    plugins: {
      legend: {
        labels: {
          generateLabels: function(chart) {
            // Get the default label list
            const original = Chart.overrides.pie.plugins.legend.labels.generateLabels;
            const labelsOriginal = original.call(this, chart);

            // Build an array of colors used in the datasets of the chart
            var datasetColors = chart.data.datasets.map(function(e) {
              return e.backgroundColor;
            });
            datasetColors = datasetColors.flat();

            // Modify the color and hide state of each label
            labelsOriginal.forEach(label => {
              // There are twice as many labels as there are datasets. This converts the label index into the corresponding dataset index
              label.datasetIndex = (label.index - label.index % 2) / 2;

              // The hidden state must match the dataset's hidden state
              label.hidden = !chart.isDatasetVisible(label.datasetIndex);

              // Change the color to match the dataset
              label.fillStyle = datasetColors[label.index];
            });

            return labelsOriginal;
          }
        },
        onClick: function(mouseEvent, legendItem, legend) {
          // toggle the visibility of the dataset from what it currently is
          legend.chart.getDatasetMeta(
            legendItem.datasetIndex
          ).hidden = legend.chart.isDatasetVisible(legendItem.datasetIndex);
          legend.chart.update();
        }
      },
      tooltip: {
        callbacks: {
          label: function(context) {
            const labelIndex = (context.datasetIndex * 2) + context.dataIndex;
            return context.chart.data.labels[labelIndex] + ': ' + context.formattedValue;
          }
        }
      }
    }
  },
};
// </block:config>

// module.exports = {
//   config: config,
// };

new Chart(document.getElementById('chart'),config)
}
window.onload = get_multiseriespie_input

</script>

{% endblock %}